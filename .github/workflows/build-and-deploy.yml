name: Build and Deploy to Skynet

on:
  create:
    tags: 
      - v[12].[0-9]+.[0-9]+

jobs: 
  build: 
    name: "Build and Deploy Application"
    runs-on: ubuntu-latest
    steps: 
      - 
        name: "Checkout repository"
        uses: actions/checkout@v2
        with: 
          fetch-depth: 0
      - 
        name: "Set up Node.js ${{ matrix.node-version }}"
        uses: actions/setup-node@v2
        with: 
          cache: yarn
          node-version: "14"
      - 
        name: "Install dependencies"
        run: "yarn install"
      - 
        name: Build
        run: "yarn run build"
      - 
        name: "Deploy to Skynet"
        uses: SkynetLabs/deploy-to-skynet-action@v2
        with: 
          github-token: "${{ secrets.GITHUB_TOKEN }}"
          registry-datakey: "${{ secrets.REGISTRY_DATAKEY || '' }}"
          registry-seed: "${{ secrets.REGISTRY_SEED || '' }}"
          upload-dir: build
